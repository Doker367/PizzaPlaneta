@page "/superadmin-dashboard"

<div class="superadmin-dashboard">
    <div class="dashboard-header">
        <div class="welcome-panel">
            <h1>Panel de Control</h1>
            <p>Bienvenido, @(usuario ?? "Super Administrador")</p>
            <div class="date-display">
                @DateTime.Now.ToString("dddd, dd MMMM yyyy", new System.Globalization.CultureInfo("es-ES"))
            </div>
        </div>
        <div class="quick-actions">
            <button class="action-button notifications" @onclick="MostrarEstadisticasSucursal">
                <i class="fas fa-chart-bar"></i>
                <span class="notification-badge">@(sucursales?.Count ?? 0)</span>
            </button>
            <button class="action-button" @onclick="CerrarSesion">
                <i class="fas fa-sign-out-alt"></i>
                Salir
            </button>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card pending-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3>Paquetes Pendientes</h3>
                <div class="stat-value">
                    <span class="counter" data-target="@paquetesPendientes">@paquetesPendientes</span>
                </div>
            </div>
        </div>

        <div class="stat-card transit-card">
            <div class="stat-icon">
                <i class="fas fa-truck"></i>
            </div>
            <div class="stat-info">
                <h3>En Camino</h3>
                <div class="stat-value">
                    <span class="counter" data-target="@paquetesEnCamino">@paquetesEnCamino</span>
                </div>
            </div>
        </div>

        <div class="stat-card delivered-card">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <h3>Entregados</h3>
                <div class="stat-value">
                    <span class="counter" data-target="@paquetesEntregados">@paquetesEntregados</span>
                </div>
            </div>
        </div>

        <div class="stat-card employees-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3>Empleados Activos</h3>
                <div class="stat-value">
                    <span class="counter" data-target="@empleadosActivos">@empleadosActivos</span>
                </div>
            </div>
        </div>
    </div>

    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Análisis de Rendimiento</h3>
                <div class="chart-controls">
                    <select class="period-selector period-selector--pill" @onchange="OnPeriodChanged" value="@selectedPeriod">
                        <option value="7">Últimos 7 días</option>
                        <option value="30">Últimos 30 días</option>
                    </select>
                </div>
            </div>
            <div class="chart-area">
                <div class="area-chart">
                    <svg width="100%" height="300" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id="gradient1" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#4facfe;stop-opacity:0.6" />
                                <stop offset="100%" style="stop-color:#4facfe;stop-opacity:0" />
                            </linearGradient>
                        </defs>
                        <!-- Grid lines -->
                        <g class="grid-lines">
                            @for (int i = 0; i <= 4; i++)
                            {
                                <line x1="0" y1="@(i * 75)" x2="100%" y2="@(i * 75)" class="grid-lines" />
                            }
                        </g>
                        <path class="area-path area1" d="@GetAreaPath(entregasPorDia)" fill="url(#gradient1)" />
                        <path class="line-path line1" d="@GetLinePath(entregasPorDia)" />

                        @if (entregasPorDia?.Count > 0)
                        {
                            var max = Math.Max(1, entregasPorDia.Max(e => e.Entregas));
                            var width = 100.0 / Math.Max(1, (entregasPorDia.Count - 1));
                            for (int i = 0; i < entregasPorDia.Count; i++)
                            {
                                var x = i * width;
                                var y = ScaleY(entregasPorDia[i].Entregas, max);
                                <circle class="data-point line1" cx="@x" cy="@y" r="4">
                                    <title>@entregasPorDia[i].Dia: @entregasPorDia[i].Entregas entregas</title>
                                </circle>
                            }

                            for (int i = 0; i < entregasPorDia.Count; i++)
                            {
                                var x = i * width;
                                var y = ScaleY(entregasPorDia[i].Entregas, max);
                                <g class="value-container">
                                    <circle cx="@x" cy="@(y - 10)" r="0.1" fill="transparent" />
                                    <foreignObject x="@(x - 15)" y="@(y - 25)" width="30" height="20">
                                        <div xmlns="http://www.w3.org/1999/xhtml" class="svg-text-value">
                                            @entregasPorDia[i].Entregas
                                        </div>
                                    </foreignObject>
                                </g>
                            }
                        }
                    </svg>
                    <div class="chart-labels chart-labels--spaced">
                        @foreach (var dia in entregasPorDia)
                        {
                            <div class="label">@dia.Dia</div>
                        }
                    </div>
                </div>
                <div class="chart-legend chart-legend--separated">
                    <div class="legend-item">
                        <div class="legend-color line1"></div>
                        <div class="legend-text">Entregas diarias</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="metrics-card">
            <h3>Sucursales Activas</h3>
            <div class="metrics-grid">
                @foreach (var (sucursal, valor) in EstadisticasPaquetes)
                {
                    <div class="metric-item">
                        <div class="metric-header">
                            <span class="metric-name">Sucursal @sucursal</span>
                            <span class="metric-value">@valor</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: @(valor)%"></div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="activity-panel">
        <h3>Actividad Reciente</h3>
        <div class="activity-list">
            @foreach (var (paquete, index) in ultimosPaquetes.Take(3).Select((p, i) => (p, i)))
            {
                <div class="activity-item">
                    <div class="activity-icon" style="@GetActivityIconStyle(index)">
                        @if (paquete.Estado == "Entregado")
                        {
                            <i class="fas fa-check-circle"></i>
                        }
                        else if (paquete.Estado == "En camino")
                        {
                            <i class="fas fa-truck"></i>
                        }
                        else
                        {
                            <i class="fas fa-clock"></i>
                        }
                    </div>
                    <div class="activity-content">
                        <div class="activity-header">
                            <span class="activity-title">Paquete #@paquete.Id</span>
                            <span class="activity-time">@GetTimeAgo(paquete.FechaRegistro)</span>
                        </div>
                        <p class="activity-description">
                            De @paquete.Remitente para @paquete.Destinatario - <span class="activity-status @GetStatusClass(paquete.Estado)">@paquete.Estado</span>
                        </p>
                    </div>
                </div>
            }
        </div>
    </div>

    @if (mostrarEstadisticasSucursal)
    {
        <div class="notifications-panel">
            <div class="notifications-header">
                <h3>Estadísticas por Sucursal</h3>
                <button class="close-notifications" @onclick="CerrarEstadisticasSucursal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notifications-list">
                <div class="form-group" style="padding: 0.5rem 1.5rem 0;">
                    <label class="form-label" style="color: #fff; display: block; margin-bottom: 0.5rem;">
                        <i class="fas fa-building"></i>
                        <span style="margin-left: 0.5rem">Selecciona una sucursal:</span>
                    </label>
                    <div class="sucursal-select">
                        <span class="sucursal-select-icon">📍</span>
                        <select class="sucursal-select-input" value="@sucursalSeleccionada" @onchange="OnSucursalChanged">
                            <option value="">-- Seleccionar Sucursal --</option>
                            @foreach (var sucursal in sucursales)
                            {
                                <option value="@sucursal">Sucursal @sucursal</option>
                            }
                        </select>
                        <span class="sucursal-select-caret"><i class="fas fa-chevron-down"></i></span>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(sucursalSeleccionada))
                {
                    <div class="notification-item">
                        <div class="notification-icon" style="background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%);">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">Paquetes Enviados</div>
                            <div class="notification-message">
                                <span class="counter" data-target="@sucursalPaquetes">@sucursalPaquetes</span>
                                <span style="opacity: 0.7; font-size: 0.9rem"> paquetes</span>
                            </div>
                            <div class="notification-time">+12% vs mes anterior</div>
                        </div>
                    </div>

                    <div class="notification-item">
                        <div class="notification-icon" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">Empleados Activos</div>
                            <div class="notification-message">
                                <span class="counter" data-target="@sucursalEmpleados">@sucursalEmpleados</span>
                                <span style="opacity: 0.7; font-size: 0.9rem"> empleados</span>
                            </div>
                            <div class="notification-time">Todos conectados</div>
                        </div>
                    </div>

                    <div class="notification-item">
                        <div class="notification-icon" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">Satisfacción Cliente</div>
                            <div class="notification-message">
                                <span class="counter" data-target="@sucursalSatisfaccion">@sucursalSatisfaccion</span>
                                <span style="opacity: 0.7; font-size: 0.9rem">%</span>
                            </div>
                            <div class="notification-time">+5% este mes</div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>

