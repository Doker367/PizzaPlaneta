@page "/cliente"

<div class="mb-actions-bar">
    <h1>👤 Clientes</h1>
    <button class="btn-dark-card" @onclick='() => NavigationManager.NavigateTo("/registrar-cliente")'>Registrar Cliente</button>
</div>

<div class="mb-search-bar">
    <div class="mb-search-row-sep">
        <InputText class="form-control" @bind-Value="busquedaCliente" placeholder="Buscar por nombre, email o teléfono..." @oninput="@(async _ => await BuscarClienteAsync(true))" />
        <button class="btn-dark-card buscador-btn" @onclick="@(async () => await BuscarClienteAsync(true))" disabled="@isLoadingBusqueda">Buscar</button>
        @if (isLoadingBusqueda)
        {
            <span class="ms-2">Buscando...</span>
        }
    </div>
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger mt-2">@errorMessage</div>
    }
</div>

@if (clientesEncontrados?.Count > 0)
{
    <div class="mb-clientes-grid">
        @foreach (var c in clientesEncontrados)
        {
            <div class="mb-cliente-card">
                <div class="mb-card-header">
                    <div class="mb-cliente-avatar">
                        <span class="mb-avatar-text">@GetInitials(c.Nombre, c.Apellido)</span>
                    </div>
                    <div class="mb-cliente-info">
                        <div class="mb-cliente-name">@c.Nombre @c.Apellido</div>
                        <div class="mb-detail-text">@c.Correo</div>
                        <div class="mb-detail-text">@c.Telefono</div>
                    </div>
                </div>
                <div class="mb-card-footer">
                    <button class="btn-dark-card" @onclick="() => MostrarInfoCliente(c)">Info</button>
                    <button class="btn-dark-card ms-2" @onclick="@(() => NavigationManager.NavigateTo($"/eliminar-cliente/{c.Id}"))">Eliminar</button>
                </div>
            </div>
        }
    </div>
    @if (mostrarBotonMostrarMas)
    {
        <div style="text-align:center;margin-top:1.5rem;">
            <button class="btn-dark-card" @onclick="@(async () => await MostrarMasClientes())">Mostrar más</button>
        </div>
    }
}
else if (!isLoadingBusqueda)
{
    <div class="alert alert-info mt-3">No hay clientes para mostrar.</div>
}

@if (clienteInfo != null)
{
    <div class="mb-modal-overlay">
        <div class="mb-modal-card mb-modal-card-md">
            <div class="mb-modal-title">Información del Cliente</div>
            <div class="mb-modal-form-responsive">
                <div><b>Nombre:</b> @clienteInfo.Nombre</div>
                <div><b>Apellido:</b> @clienteInfo.Apellido</div>
                <div><b>Email:</b> @clienteInfo.Correo</div>
                <div><b>Teléfono:</b> @clienteInfo.Telefono</div>
            </div>
            <div class="mb-modal-actions mb-modal-actions-center">
                <button class="btn-dark-card" @onclick="CerrarInfoCliente">Cerrar</button>
            </div>
        </div>
    </div>
}



