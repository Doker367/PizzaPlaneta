@page "/employee-dashboard"
@layout Layout.MainLayout

 
<div class="employee-dashboard">
    <div class="dashboard-header">
        <div class="welcome-panel">
            <h1>Panel del Empleado</h1>
            <p>Bienvenido, @(usuario ?? "Empleado")</p>
            <div class="date-display">
                @DateTime.Now.ToString("dddd, dd MMMM yyyy", new System.Globalization.CultureInfo("es-ES"))
            </div>
        </div>
        <div class="quick-actions">
            <button class="action-button refresh">
                <i class="fas fa-sync-alt"></i>
                Actualizar
            </button>
            <button class="action-button notifications" @onclick="ToggleNotifications">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">@notifications.Count</span>
            </button>
            <button class="action-button" @onclick="CerrarSesion">
                <i class="fas fa-sign-out-alt"></i>
                Salir
            </button>
        </div>
    </div>

    <div class="stats-grid">
        @foreach (var stat in dashboardStats)
        {
            <div class="stat-card @stat.Class">
                <div class="stat-icon">
                    <i class="@stat.Icon"></i>
                </div>
                <div class="stat-info">
                    <h3>@stat.Title</h3>
                    <div class="stat-value">
                        <span class="counter" data-target="@stat.Value">0</span>
                        @if (!string.IsNullOrEmpty(stat.Unit))
                        {
                            <span class="unit">@stat.Unit</span>
                        }
                    </div>
                    <div class="stat-change @stat.TrendClass">
                        <i class="@stat.TrendIcon"></i>
                        @stat.Change
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-header">
                <h3>Entregas Semanales</h3>
                <div class="chart-controls">
                    <select @bind="selectedPeriod" class="period-selector">
                        <option value="week">Esta semana</option>
                        <option value="month">Este mes</option>
                        <option value="year">Este año</option>
                    </select>
                </div>
            </div>
            <div class="chart-area">
                <div class="chart-summary">
                    <div class="summary-item">
                        <span class="summary-label">Esta semana</span>
                        <span class="summary-value">
                            <span class="counter" data-target="@entregasSemana.Sum(x => x.Entregas)">0</span>
                        </span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Promedio diario</span>
                        <span class="summary-value">
                            <span class="counter" data-target="@Math.Round(entregasSemana.Average(x => x.Entregas))">0</span>
                        </span>
                    </div>
                </div>
                <div class="area-chart">
                    <svg width="100%" height="300" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id="gradient1" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.6" />
                                <stop offset="100%" style="stop-color:#10b981;stop-opacity:0" />
                            </linearGradient>
                            <linearGradient id="gradient2" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#6ee7b7;stop-opacity:0.6" />
                                <stop offset="100%" style="stop-color:#6ee7b7;stop-opacity:0" />
                            </linearGradient>
                        </defs>
                        <!-- Grid lines -->
                        <g class="grid-lines">
                            @for (int i = 0; i <= 4; i++)
                            {
                                <line x1="0" y1="@(i * 75)" x2="100%" y2="@(i * 75)" class="grid-lines" />
                            }
                        </g>
                        <path class="area-path area1" d="@GetAreaPath(entregasSemana)" fill="url(#gradient1)" />
                        <path class="line-path line1" d="@GetLinePath(entregasSemana)" />

                        @for (int i = 0; i < entregasSemana.Count; i++)
                        {
                            var x = i * (100.0 / (entregasSemana.Count - 1));
                            var y = 300 - (entregasSemana[i].Entregas * 15);
                            <circle class="data-point line1" cx="@x" cy="@y" r="4" />
                        }

                        @for (int i = 0; i < entregasSemana.Count; i++)
                        {
                            var x = i * (100.0 / (entregasSemana.Count - 1));
                            var y = 300 - (entregasSemana[i].Entregas * 15);
                            <g class="value-container">
                                <circle cx="@x" cy="@(y - 10)" r="0.1" fill="transparent" />
                                <foreignObject x="@(x - 15)" y="@(y - 25)" width="30" height="20">
                                    <div xmlns="http://www.w3.org/1999/xhtml" class="svg-text-value">
                                        @entregasSemana[i].Entregas
                                    </div>
                                </foreignObject>
                            </g>
                        }
                    </svg>
                    <div class="chart-labels">
                        @foreach (var data in entregasSemana)
                        {
                            <div class="label">@data.Dia</div>
                        }
                    </div>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color line1"></div>
                        <div class="legend-text">Entregas diarias</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="metrics-card">
            <h3>Rendimiento por Día</h3>
            <div class="metrics-grid">
                @foreach (var metric in rendimientoMetrics)
                {
                    <div class="metric-item">
                        <div class="metric-header">
                            <span class="metric-name">@metric.Name</span>
                            <span class="metric-value">@metric.Value%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: @(metric.Value)%"></div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="activity-panel">
        <h3>Actividad Reciente</h3>
        <div class="activity-list">
            @foreach (var activity in actividadesRecientes)
            {
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="@activity.Icon"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-header">
                            <span class="activity-title">@activity.Titulo</span>
                            <span class="activity-time">@activity.Time</span>
                        </div>
                        <p class="activity-description">@activity.Descripcion</p>
                    </div>
                </div>
            }
        </div>
    </div>

    @if (showNotifications)
    {
        <div class="notifications-panel">
            <div class="notifications-header">
                <h3>Notificaciones</h3>
                <button class="close-notifications" @onclick="ToggleNotifications">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notifications-list">
                @foreach (var notification in notifications)
                {
                    <div class="notification-item @notification.Priority">
                        <div class="notification-icon">
                            <i class="@notification.Icon"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">@notification.Title</div>
                            <div class="notification-message">@notification.Message</div>
                            <div class="notification-time">@notification.Time</div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>

